---
import bigCTASplashVectorBG from '../images/bigCTASplashVectorBG.svg'
import bigCTAKidBG from '../images/bigCTAKidBG.png'
import Button from '../components/system/Button.astro';
import Text from './system/Text.astro';
import Constrain from './system/Constrain.astro';
import { Image } from 'astro:assets';
import { marked } from 'marked'

import { getEntries, getEntry, type CollectionEntry } from 'astro:content';
const { data } = await getEntry('home', 'home') as CollectionEntry<'home'>

const bigAdmissionCTA = data.bigAdmissionCTA
const {shouldSecondaryCTA = true} = Astro.props

const headingArr = bigAdmissionCTA?.heading?.split(" ") || []
const headingHalf = Math.ceil(headingArr.length / 2)
const headingFirstHalf = headingArr.slice(0, headingHalf).join(" ")
const headingSecondHalf = headingArr.slice(headingHalf, headingArr.length).join(" ")

const bigAdmissionCTABody = marked.parse(bigAdmissionCTA?.body || '')
---

<div class='px-20 py-6 bg-white max-md:px-4 max-md:py-4'>
  <Constrain>
    <div class='w-full rounded-2xl border border-black/25 p-3 max-md:p-0 max-md:border-none'>
      <div 
        class='w-full rounded-2xl flex flex-col items-center py-20 relative overflow-hidden max-md:py-10'
        style={{
          background: 'linear-gradient(180deg, #3C674F 0%, #00401C 63.69%)',
          boxShadow: 'inset 0px 0px 0px 5px rgba(255, 255, 255, 0.2)'
        }}>
          <Image src={bigCTASplashVectorBG} class="absolute -top-2 left-0 max-md:-top-28 max-md:-left-20" role="presentation" alt="decorative"/>
          <Image src={bigCTAKidBG} class="absolute bottom-0 right-0  max-md:right-0 max-md:-bottom-8 max-md:w-20" alt="Glentree Academy Admissions Open for 2024-25" />
          <Text type={'subtitle'} style={{ letterSpacing: '0.1em' }}>{bigAdmissionCTA?.subtitle}</Text>
          <Text type={'h2'} class='relative mt-5 text-center leading-10'>
          {headingFirstHalf}<br class='hidden max-md:block' />&nbsp;{headingSecondHalf}
          </Text>
          <Text type={'base'} class='w-[70%] max-md:w-[88%] text-center mt-5 max-md:mt-3'>
            <div set:html={bigAdmissionCTABody}>
            </div>
          </Text>
          <div class='flex flex-row mt-10 max-md:mt-8 max-md:flex-col max-md:items-center'>
            <a href={bigAdmissionCTA?.primaryCTALink} target='_blank'>
              <Button>{bigAdmissionCTA?.primaryCTAText}</Button>
            </a>
            {shouldSecondaryCTA && (
              <a href={bigAdmissionCTA?.secondaryCTALink}>
                <Button secondary class='ml-4 max-md:mt-4 max-md:ml-0'>{bigAdmissionCTA?.secondaryCTAText}</Button>
              </a>
            )}
          </div>
        </div>
    </div>
  </Constrain>
</div>

